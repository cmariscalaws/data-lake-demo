Resources:
  DataLakeKey37130A3E:
    Type: AWS::KMS::Key
    Properties:
      EnableKeyRotation: true
      KeyPolicy:
        Statement:
          - Action: kms:*
            Effect: Allow
            Principal:
              AWS:
                Fn::Join:
                  - ""
                  - - "arn:"
                    - Ref: AWS::Partition
                    - ":iam::"
                    - Ref: AWS::AccountId
                    - :root
            Resource: "*"
        Version: "2012-10-17"
    UpdateReplacePolicy: Retain
    DeletionPolicy: Retain
    Metadata:
      aws:cdk:path: OptionAIngestionDemoPy/DataLakeKey/Resource
  DataLakeBucket0256EA8E:
    Type: AWS::S3::Bucket
    Properties:
      BucketEncryption:
        ServerSideEncryptionConfiguration:
          - ServerSideEncryptionByDefault:
              KMSMasterKeyID:
                Fn::GetAtt:
                  - DataLakeKey37130A3E
                  - Arn
              SSEAlgorithm: aws:kms
      PublicAccessBlockConfiguration:
        BlockPublicAcls: true
        BlockPublicPolicy: true
        IgnorePublicAcls: true
        RestrictPublicBuckets: true
      VersioningConfiguration:
        Status: Enabled
    UpdateReplacePolicy: Retain
    DeletionPolicy: Retain
    Metadata:
      aws:cdk:path: OptionAIngestionDemoPy/DataLakeBucket/Resource
  DataLakeBucketPolicy52869FB4:
    Type: AWS::S3::BucketPolicy
    Properties:
      Bucket:
        Ref: DataLakeBucket0256EA8E
      PolicyDocument:
        Statement:
          - Action: s3:*
            Condition:
              Bool:
                aws:SecureTransport: "false"
            Effect: Deny
            Principal:
              AWS: "*"
            Resource:
              - Fn::GetAtt:
                  - DataLakeBucket0256EA8E
                  - Arn
              - Fn::Join:
                  - ""
                  - - Fn::GetAtt:
                        - DataLakeBucket0256EA8E
                        - Arn
                    - /*
        Version: "2012-10-17"
    Metadata:
      aws:cdk:path: OptionAIngestionDemoPy/DataLakeBucket/Policy/Resource
  AthenaResultsBucket879938FA:
    Type: AWS::S3::Bucket
    Properties:
      BucketEncryption:
        ServerSideEncryptionConfiguration:
          - ServerSideEncryptionByDefault:
              SSEAlgorithm: AES256
      LifecycleConfiguration:
        Rules:
          - ExpirationInDays: 30
            Status: Enabled
      PublicAccessBlockConfiguration:
        BlockPublicAcls: true
        BlockPublicPolicy: true
        IgnorePublicAcls: true
        RestrictPublicBuckets: true
    UpdateReplacePolicy: Retain
    DeletionPolicy: Retain
    Metadata:
      aws:cdk:path: OptionAIngestionDemoPy/AthenaResultsBucket/Resource
  AthenaResultsBucketPolicyD63DEF63:
    Type: AWS::S3::BucketPolicy
    Properties:
      Bucket:
        Ref: AthenaResultsBucket879938FA
      PolicyDocument:
        Statement:
          - Action: s3:*
            Condition:
              Bool:
                aws:SecureTransport: "false"
            Effect: Deny
            Principal:
              AWS: "*"
            Resource:
              - Fn::GetAtt:
                  - AthenaResultsBucket879938FA
                  - Arn
              - Fn::Join:
                  - ""
                  - - Fn::GetAtt:
                        - AthenaResultsBucket879938FA
                        - Arn
                    - /*
        Version: "2012-10-17"
    Metadata:
      aws:cdk:path: OptionAIngestionDemoPy/AthenaResultsBucket/Policy/Resource
  APIADLQC9CEB354:
    Type: AWS::SQS::Queue
    Properties:
      MessageRetentionPeriod: 1209600
      SqsManagedSseEnabled: true
    UpdateReplacePolicy: Delete
    DeletionPolicy: Delete
    Metadata:
      aws:cdk:path: OptionAIngestionDemoPy/API-ADLQ/Resource
  APIAQueue131AD127:
    Type: AWS::SQS::Queue
    Properties:
      MessageRetentionPeriod: 345600
      RedrivePolicy:
        deadLetterTargetArn:
          Fn::GetAtt:
            - APIADLQC9CEB354
            - Arn
        maxReceiveCount: 5
      SqsManagedSseEnabled: true
      VisibilityTimeout: 180
    UpdateReplacePolicy: Delete
    DeletionPolicy: Delete
    Metadata:
      aws:cdk:path: OptionAIngestionDemoPy/API-AQueue/Resource
  APIBDLQ99128402:
    Type: AWS::SQS::Queue
    Properties:
      MessageRetentionPeriod: 1209600
      SqsManagedSseEnabled: true
    UpdateReplacePolicy: Delete
    DeletionPolicy: Delete
    Metadata:
      aws:cdk:path: OptionAIngestionDemoPy/API-BDLQ/Resource
  APIBQueue86514826:
    Type: AWS::SQS::Queue
    Properties:
      MessageRetentionPeriod: 345600
      RedrivePolicy:
        deadLetterTargetArn:
          Fn::GetAtt:
            - APIBDLQ99128402
            - Arn
        maxReceiveCount: 5
      SqsManagedSseEnabled: true
      VisibilityTimeout: 180
    UpdateReplacePolicy: Delete
    DeletionPolicy: Delete
    Metadata:
      aws:cdk:path: OptionAIngestionDemoPy/API-BQueue/Resource
  APICDLQ9DA9DB16:
    Type: AWS::SQS::Queue
    Properties:
      MessageRetentionPeriod: 1209600
      SqsManagedSseEnabled: true
    UpdateReplacePolicy: Delete
    DeletionPolicy: Delete
    Metadata:
      aws:cdk:path: OptionAIngestionDemoPy/API-CDLQ/Resource
  APICQueue41397192:
    Type: AWS::SQS::Queue
    Properties:
      MessageRetentionPeriod: 345600
      RedrivePolicy:
        deadLetterTargetArn:
          Fn::GetAtt:
            - APICDLQ9DA9DB16
            - Arn
        maxReceiveCount: 5
      SqsManagedSseEnabled: true
      VisibilityTimeout: 180
    UpdateReplacePolicy: Delete
    DeletionPolicy: Delete
    Metadata:
      aws:cdk:path: OptionAIngestionDemoPy/API-CQueue/Resource
  APIDDLQ86883D54:
    Type: AWS::SQS::Queue
    Properties:
      MessageRetentionPeriod: 1209600
      SqsManagedSseEnabled: true
    UpdateReplacePolicy: Delete
    DeletionPolicy: Delete
    Metadata:
      aws:cdk:path: OptionAIngestionDemoPy/API-DDLQ/Resource
  APIDQueue6C5AE567:
    Type: AWS::SQS::Queue
    Properties:
      MessageRetentionPeriod: 345600
      RedrivePolicy:
        deadLetterTargetArn:
          Fn::GetAtt:
            - APIDDLQ86883D54
            - Arn
        maxReceiveCount: 5
      SqsManagedSseEnabled: true
      VisibilityTimeout: 180
    UpdateReplacePolicy: Delete
    DeletionPolicy: Delete
    Metadata:
      aws:cdk:path: OptionAIngestionDemoPy/API-DQueue/Resource
  PlannerFnServiceRoleC7632B24:
    Type: AWS::IAM::Role
    Properties:
      AssumeRolePolicyDocument:
        Statement:
          - Action: sts:AssumeRole
            Effect: Allow
            Principal:
              Service: lambda.amazonaws.com
        Version: "2012-10-17"
      ManagedPolicyArns:
        - Fn::Join:
            - ""
            - - "arn:"
              - Ref: AWS::Partition
              - :iam::aws:policy/service-role/AWSLambdaBasicExecutionRole
    Metadata:
      aws:cdk:path: OptionAIngestionDemoPy/PlannerFn/ServiceRole/Resource
  PlannerFnServiceRoleDefaultPolicyDBE6D0AF:
    Type: AWS::IAM::Policy
    Properties:
      PolicyDocument:
        Statement:
          - Action:
              - sqs:SendMessage
              - sqs:GetQueueAttributes
              - sqs:GetQueueUrl
            Effect: Allow
            Resource:
              Fn::GetAtt:
                - APIAQueue131AD127
                - Arn
          - Action:
              - sqs:SendMessage
              - sqs:GetQueueAttributes
              - sqs:GetQueueUrl
            Effect: Allow
            Resource:
              Fn::GetAtt:
                - APIBQueue86514826
                - Arn
          - Action:
              - sqs:SendMessage
              - sqs:GetQueueAttributes
              - sqs:GetQueueUrl
            Effect: Allow
            Resource:
              Fn::GetAtt:
                - APICQueue41397192
                - Arn
          - Action:
              - sqs:SendMessage
              - sqs:GetQueueAttributes
              - sqs:GetQueueUrl
            Effect: Allow
            Resource:
              Fn::GetAtt:
                - APIDQueue6C5AE567
                - Arn
        Version: "2012-10-17"
      PolicyName: PlannerFnServiceRoleDefaultPolicyDBE6D0AF
      Roles:
        - Ref: PlannerFnServiceRoleC7632B24
    Metadata:
      aws:cdk:path: OptionAIngestionDemoPy/PlannerFn/ServiceRole/DefaultPolicy/Resource
  PlannerFn9855CFD1:
    Type: AWS::Lambda::Function
    Properties:
      Code:
        S3Bucket:
          Fn::Sub: cdk-hnb659fds-assets-${AWS::AccountId}-${AWS::Region}
        S3Key: de795497bfc96226a23b0068bb4362866c546d8773d3e06a5b057904d6ef4d5e.zip
      Environment:
        Variables:
          QUEUE_URLS_JSON:
            Fn::Join:
              - ""
              - - '{"api-a": "'
                - Ref: APIAQueue131AD127
                - '", "api-b": "'
                - Ref: APIBQueue86514826
                - '", "api-c": "'
                - Ref: APICQueue41397192
                - '", "api-d": "'
                - Ref: APIDQueue6C5AE567
                - '"}'
      Handler: planner.handler
      MemorySize: 256
      Role:
        Fn::GetAtt:
          - PlannerFnServiceRoleC7632B24
          - Arn
      Runtime: python3.12
      Timeout: 60
    DependsOn:
      - PlannerFnServiceRoleDefaultPolicyDBE6D0AF
      - PlannerFnServiceRoleC7632B24
    Metadata:
      aws:cdk:path: OptionAIngestionDemoPy/PlannerFn/Resource
      aws:asset:path: asset.de795497bfc96226a23b0068bb4362866c546d8773d3e06a5b057904d6ef4d5e
      aws:asset:is-bundled: false
      aws:asset:property: Code
  PlannerFnLogRetention0339B75E:
    Type: Custom::LogRetention
    Properties:
      ServiceToken:
        Fn::GetAtt:
          - LogRetentionaae0aa3c5b4d4f87b02d85b201efdd8aFD4BFC8A
          - Arn
      LogGroupName:
        Fn::Join:
          - ""
          - - /aws/lambda/
            - Ref: PlannerFn9855CFD1
      RetentionInDays: 7
    Metadata:
      aws:cdk:path: OptionAIngestionDemoPy/PlannerFn/LogRetention/Resource
  LogRetentionaae0aa3c5b4d4f87b02d85b201efdd8aServiceRole9741ECFB:
    Type: AWS::IAM::Role
    Properties:
      AssumeRolePolicyDocument:
        Statement:
          - Action: sts:AssumeRole
            Effect: Allow
            Principal:
              Service: lambda.amazonaws.com
        Version: "2012-10-17"
      ManagedPolicyArns:
        - Fn::Join:
            - ""
            - - "arn:"
              - Ref: AWS::Partition
              - :iam::aws:policy/service-role/AWSLambdaBasicExecutionRole
    Metadata:
      aws:cdk:path: OptionAIngestionDemoPy/LogRetentionaae0aa3c5b4d4f87b02d85b201efdd8a/ServiceRole/Resource
  LogRetentionaae0aa3c5b4d4f87b02d85b201efdd8aServiceRoleDefaultPolicyADDA7DEB:
    Type: AWS::IAM::Policy
    Properties:
      PolicyDocument:
        Statement:
          - Action:
              - logs:PutRetentionPolicy
              - logs:DeleteRetentionPolicy
            Effect: Allow
            Resource: "*"
        Version: "2012-10-17"
      PolicyName: LogRetentionaae0aa3c5b4d4f87b02d85b201efdd8aServiceRoleDefaultPolicyADDA7DEB
      Roles:
        - Ref: LogRetentionaae0aa3c5b4d4f87b02d85b201efdd8aServiceRole9741ECFB
    Metadata:
      aws:cdk:path: OptionAIngestionDemoPy/LogRetentionaae0aa3c5b4d4f87b02d85b201efdd8a/ServiceRole/DefaultPolicy/Resource
  LogRetentionaae0aa3c5b4d4f87b02d85b201efdd8aFD4BFC8A:
    Type: AWS::Lambda::Function
    Properties:
      Handler: index.handler
      Runtime:
        Fn::FindInMap:
          - LatestNodeRuntimeMap
          - Ref: AWS::Region
          - value
      Timeout: 900
      Code:
        S3Bucket:
          Fn::Sub: cdk-hnb659fds-assets-${AWS::AccountId}-${AWS::Region}
        S3Key: 4e26bf2d0a26f2097fb2b261f22bb51e3f6b4b52635777b1e54edbd8e2d58c35.zip
      Role:
        Fn::GetAtt:
          - LogRetentionaae0aa3c5b4d4f87b02d85b201efdd8aServiceRole9741ECFB
          - Arn
    DependsOn:
      - LogRetentionaae0aa3c5b4d4f87b02d85b201efdd8aServiceRoleDefaultPolicyADDA7DEB
      - LogRetentionaae0aa3c5b4d4f87b02d85b201efdd8aServiceRole9741ECFB
    Metadata:
      aws:cdk:path: OptionAIngestionDemoPy/LogRetentionaae0aa3c5b4d4f87b02d85b201efdd8a/Resource
      aws:asset:path: asset.4e26bf2d0a26f2097fb2b261f22bb51e3f6b4b52635777b1e54edbd8e2d58c35
      aws:asset:is-bundled: false
      aws:asset:property: Code
  CronRule93635715:
    Type: AWS::Events::Rule
    Properties:
      ScheduleExpression: cron(*/5 * * * ? *)
      State: ENABLED
      Targets:
        - Arn:
            Fn::GetAtt:
              - PlannerFn9855CFD1
              - Arn
          Id: Target0
    Metadata:
      aws:cdk:path: OptionAIngestionDemoPy/CronRule/Resource
  CronRuleAllowEventRuleOptionAIngestionDemoPyPlannerFn201FB7FB55A57312:
    Type: AWS::Lambda::Permission
    Properties:
      Action: lambda:InvokeFunction
      FunctionName:
        Fn::GetAtt:
          - PlannerFn9855CFD1
          - Arn
      Principal: events.amazonaws.com
      SourceArn:
        Fn::GetAtt:
          - CronRule93635715
          - Arn
    Metadata:
      aws:cdk:path: OptionAIngestionDemoPy/CronRule/AllowEventRuleOptionAIngestionDemoPyPlannerFn201FB7FB
  WorkerFnServiceRole66434362:
    Type: AWS::IAM::Role
    Properties:
      AssumeRolePolicyDocument:
        Statement:
          - Action: sts:AssumeRole
            Effect: Allow
            Principal:
              Service: lambda.amazonaws.com
        Version: "2012-10-17"
      ManagedPolicyArns:
        - Fn::Join:
            - ""
            - - "arn:"
              - Ref: AWS::Partition
              - :iam::aws:policy/service-role/AWSLambdaBasicExecutionRole
    Metadata:
      aws:cdk:path: OptionAIngestionDemoPy/WorkerFn/ServiceRole/Resource
  WorkerFnServiceRoleDefaultPolicy81568881:
    Type: AWS::IAM::Policy
    Properties:
      PolicyDocument:
        Statement:
          - Action:
              - s3:GetObject*
              - s3:GetBucket*
              - s3:List*
            Effect: Allow
            Resource:
              - Fn::GetAtt:
                  - DataLakeBucket0256EA8E
                  - Arn
              - Fn::Join:
                  - ""
                  - - Fn::GetAtt:
                        - DataLakeBucket0256EA8E
                        - Arn
                    - /*
          - Action:
              - kms:Decrypt
              - kms:DescribeKey
            Effect: Allow
            Resource:
              Fn::GetAtt:
                - DataLakeKey37130A3E
                - Arn
          - Action:
              - s3:PutObject
              - s3:PutObjectLegalHold
              - s3:PutObjectRetention
              - s3:PutObjectTagging
              - s3:PutObjectVersionTagging
              - s3:Abort*
            Effect: Allow
            Resource:
              Fn::Join:
                - ""
                - - Fn::GetAtt:
                      - DataLakeBucket0256EA8E
                      - Arn
                  - /*
          - Action:
              - kms:Encrypt
              - kms:ReEncrypt*
              - kms:GenerateDataKey*
              - kms:Decrypt
            Effect: Allow
            Resource:
              Fn::GetAtt:
                - DataLakeKey37130A3E
                - Arn
          - Action:
              - sqs:ReceiveMessage
              - sqs:ChangeMessageVisibility
              - sqs:GetQueueUrl
              - sqs:DeleteMessage
              - sqs:GetQueueAttributes
            Effect: Allow
            Resource:
              Fn::GetAtt:
                - APIAQueue131AD127
                - Arn
          - Action:
              - sqs:ReceiveMessage
              - sqs:ChangeMessageVisibility
              - sqs:GetQueueUrl
              - sqs:DeleteMessage
              - sqs:GetQueueAttributes
            Effect: Allow
            Resource:
              Fn::GetAtt:
                - APIBQueue86514826
                - Arn
          - Action:
              - sqs:ReceiveMessage
              - sqs:ChangeMessageVisibility
              - sqs:GetQueueUrl
              - sqs:DeleteMessage
              - sqs:GetQueueAttributes
            Effect: Allow
            Resource:
              Fn::GetAtt:
                - APICQueue41397192
                - Arn
          - Action:
              - sqs:ReceiveMessage
              - sqs:ChangeMessageVisibility
              - sqs:GetQueueUrl
              - sqs:DeleteMessage
              - sqs:GetQueueAttributes
            Effect: Allow
            Resource:
              Fn::GetAtt:
                - APIDQueue6C5AE567
                - Arn
        Version: "2012-10-17"
      PolicyName: WorkerFnServiceRoleDefaultPolicy81568881
      Roles:
        - Ref: WorkerFnServiceRole66434362
    Metadata:
      aws:cdk:path: OptionAIngestionDemoPy/WorkerFn/ServiceRole/DefaultPolicy/Resource
  WorkerFn847949AF:
    Type: AWS::Lambda::Function
    Properties:
      Code:
        S3Bucket:
          Fn::Sub: cdk-hnb659fds-assets-${AWS::AccountId}-${AWS::Region}
        S3Key: de795497bfc96226a23b0068bb4362866c546d8773d3e06a5b057904d6ef4d5e.zip
      Environment:
        Variables:
          DATA_LAKE_BUCKET:
            Ref: DataLakeBucket0256EA8E
          USE_REAL_HTTP: "false"
          MAX_RETRIES: "5"
          QPS_SLEEP_MS: "50"
          ENDPOINT_MAP: '{"api-a": "https://example.com/api-a", "api-b": "https://example.com/api-b", "api-c": "https://example.com/api-c", "api-d": "https://example.com/api-d"}'
      Handler: worker.handler
      MemorySize: 512
      Role:
        Fn::GetAtt:
          - WorkerFnServiceRole66434362
          - Arn
      Runtime: python3.12
      Timeout: 180
    DependsOn:
      - WorkerFnServiceRoleDefaultPolicy81568881
      - WorkerFnServiceRole66434362
    Metadata:
      aws:cdk:path: OptionAIngestionDemoPy/WorkerFn/Resource
      aws:asset:path: asset.de795497bfc96226a23b0068bb4362866c546d8773d3e06a5b057904d6ef4d5e
      aws:asset:is-bundled: false
      aws:asset:property: Code
  WorkerFnLogRetention92FA3A22:
    Type: Custom::LogRetention
    Properties:
      ServiceToken:
        Fn::GetAtt:
          - LogRetentionaae0aa3c5b4d4f87b02d85b201efdd8aFD4BFC8A
          - Arn
      LogGroupName:
        Fn::Join:
          - ""
          - - /aws/lambda/
            - Ref: WorkerFn847949AF
      RetentionInDays: 7
    Metadata:
      aws:cdk:path: OptionAIngestionDemoPy/WorkerFn/LogRetention/Resource
  WorkerFnSqsEventSourceOptionAIngestionDemoPyAPIAQueue46E17B0E2DEBB60D:
    Type: AWS::Lambda::EventSourceMapping
    Properties:
      BatchSize: 2
      EventSourceArn:
        Fn::GetAtt:
          - APIAQueue131AD127
          - Arn
      FunctionName:
        Ref: WorkerFn847949AF
      MaximumBatchingWindowInSeconds: 2
    Metadata:
      aws:cdk:path: OptionAIngestionDemoPy/WorkerFn/SqsEventSource:OptionAIngestionDemoPyAPIAQueue46E17B0E/Resource
  WorkerFnSqsEventSourceOptionAIngestionDemoPyAPIBQueue5F56E845962FDFED:
    Type: AWS::Lambda::EventSourceMapping
    Properties:
      BatchSize: 2
      EventSourceArn:
        Fn::GetAtt:
          - APIBQueue86514826
          - Arn
      FunctionName:
        Ref: WorkerFn847949AF
      MaximumBatchingWindowInSeconds: 2
    Metadata:
      aws:cdk:path: OptionAIngestionDemoPy/WorkerFn/SqsEventSource:OptionAIngestionDemoPyAPIBQueue5F56E845/Resource
  WorkerFnSqsEventSourceOptionAIngestionDemoPyAPICQueueD9CDFE1A97A30D25:
    Type: AWS::Lambda::EventSourceMapping
    Properties:
      BatchSize: 2
      EventSourceArn:
        Fn::GetAtt:
          - APICQueue41397192
          - Arn
      FunctionName:
        Ref: WorkerFn847949AF
      MaximumBatchingWindowInSeconds: 2
    Metadata:
      aws:cdk:path: OptionAIngestionDemoPy/WorkerFn/SqsEventSource:OptionAIngestionDemoPyAPICQueueD9CDFE1A/Resource
  WorkerFnSqsEventSourceOptionAIngestionDemoPyAPIDQueue7F3E07077F5ABF99:
    Type: AWS::Lambda::EventSourceMapping
    Properties:
      BatchSize: 2
      EventSourceArn:
        Fn::GetAtt:
          - APIDQueue6C5AE567
          - Arn
      FunctionName:
        Ref: WorkerFn847949AF
      MaximumBatchingWindowInSeconds: 2
    Metadata:
      aws:cdk:path: OptionAIngestionDemoPy/WorkerFn/SqsEventSource:OptionAIngestionDemoPyAPIDQueue7F3E0707/Resource
  DataLakeDb:
    Type: AWS::Glue::Database
    Properties:
      CatalogId:
        Ref: AWS::AccountId
      DatabaseInput:
        Name: option_a_demo_db
    Metadata:
      aws:cdk:path: OptionAIngestionDemoPy/DataLakeDb
  CrawlerRoleA9495AEE:
    Type: AWS::IAM::Role
    Properties:
      AssumeRolePolicyDocument:
        Statement:
          - Action: sts:AssumeRole
            Effect: Allow
            Principal:
              Service: glue.amazonaws.com
        Version: "2012-10-17"
    Metadata:
      aws:cdk:path: OptionAIngestionDemoPy/CrawlerRole/Resource
  CrawlerRoleDefaultPolicy145A4322:
    Type: AWS::IAM::Policy
    Properties:
      PolicyDocument:
        Statement:
          - Action:
              - s3:GetObject*
              - s3:GetBucket*
              - s3:List*
            Effect: Allow
            Resource:
              - Fn::GetAtt:
                  - DataLakeBucket0256EA8E
                  - Arn
              - Fn::Join:
                  - ""
                  - - Fn::GetAtt:
                        - DataLakeBucket0256EA8E
                        - Arn
                    - /*
          - Action:
              - kms:Decrypt
              - kms:DescribeKey
            Effect: Allow
            Resource:
              Fn::GetAtt:
                - DataLakeKey37130A3E
                - Arn
          - Action:
              - logs:CreateLogGroup
              - logs:CreateLogStream
              - logs:PutLogEvents
              - logs:DescribeLogGroups
              - logs:DescribeLogStreams
            Effect: Allow
            Resource: arn:aws:logs:*:*:*
          - Action:
              - glue:GetDatabase
              - glue:GetDatabases
              - glue:CreateTable
              - glue:UpdateTable
              - glue:GetTable
              - glue:GetTables
              - glue:DeleteTable
              - glue:BatchCreatePartition
              - glue:BatchDeletePartition
              - glue:GetPartition
              - glue:GetPartitions
              - glue:BatchGetPartition
              - glue:CreatePartition
              - glue:UpdatePartition
              - glue:DeletePartition
            Effect: Allow
            Resource: "*"
        Version: "2012-10-17"
      PolicyName: CrawlerRoleDefaultPolicy145A4322
      Roles:
        - Ref: CrawlerRoleA9495AEE
    Metadata:
      aws:cdk:path: OptionAIngestionDemoPy/CrawlerRole/DefaultPolicy/Resource
  RawCrawler:
    Type: AWS::Glue::Crawler
    Properties:
      DatabaseName: option_a_demo_db
      Name: option-a-raw-crawler
      Role:
        Fn::GetAtt:
          - CrawlerRoleA9495AEE
          - Arn
      Schedule:
        ScheduleExpression: cron(*/10 * * * ? *)
      SchemaChangePolicy:
        DeleteBehavior: DEPRECATE_IN_DATABASE
        UpdateBehavior: UPDATE_IN_DATABASE
      Targets:
        S3Targets:
          - Path:
              Fn::Join:
                - ""
                - - s3://
                  - Ref: DataLakeBucket0256EA8E
                  - /raw/
    Metadata:
      aws:cdk:path: OptionAIngestionDemoPy/RawCrawler
  AthenaWG:
    Type: AWS::Athena::WorkGroup
    Properties:
      Name: option_a_demo_wg
      State: ENABLED
      WorkGroupConfiguration:
        EnforceWorkGroupConfiguration: true
        PublishCloudWatchMetricsEnabled: true
        ResultConfiguration:
          OutputLocation:
            Fn::Join:
              - ""
              - - s3://
                - Ref: AthenaResultsBucket879938FA
                - /
    Metadata:
      aws:cdk:path: OptionAIngestionDemoPy/AthenaWG
  APIADLQAlarmAD0C4F86:
    Type: AWS::CloudWatch::Alarm
    Properties:
      ComparisonOperator: GreaterThanThreshold
      DatapointsToAlarm: 1
      Dimensions:
        - Name: QueueName
          Value:
            Fn::GetAtt:
              - APIADLQC9CEB354
              - QueueName
      EvaluationPeriods: 1
      MetricName: ApproximateNumberOfMessagesVisible
      Namespace: AWS/SQS
      Period: 300
      Statistic: Maximum
      Threshold: 0
    Metadata:
      aws:cdk:path: OptionAIngestionDemoPy/API-ADLQAlarm/Resource
  APIBDLQAlarmEC8ABA8D:
    Type: AWS::CloudWatch::Alarm
    Properties:
      ComparisonOperator: GreaterThanThreshold
      DatapointsToAlarm: 1
      Dimensions:
        - Name: QueueName
          Value:
            Fn::GetAtt:
              - APIBDLQ99128402
              - QueueName
      EvaluationPeriods: 1
      MetricName: ApproximateNumberOfMessagesVisible
      Namespace: AWS/SQS
      Period: 300
      Statistic: Maximum
      Threshold: 0
    Metadata:
      aws:cdk:path: OptionAIngestionDemoPy/API-BDLQAlarm/Resource
  APICDLQAlarm4DE0FB4A:
    Type: AWS::CloudWatch::Alarm
    Properties:
      ComparisonOperator: GreaterThanThreshold
      DatapointsToAlarm: 1
      Dimensions:
        - Name: QueueName
          Value:
            Fn::GetAtt:
              - APICDLQ9DA9DB16
              - QueueName
      EvaluationPeriods: 1
      MetricName: ApproximateNumberOfMessagesVisible
      Namespace: AWS/SQS
      Period: 300
      Statistic: Maximum
      Threshold: 0
    Metadata:
      aws:cdk:path: OptionAIngestionDemoPy/API-CDLQAlarm/Resource
  APIDDLQAlarm357D658F:
    Type: AWS::CloudWatch::Alarm
    Properties:
      ComparisonOperator: GreaterThanThreshold
      DatapointsToAlarm: 1
      Dimensions:
        - Name: QueueName
          Value:
            Fn::GetAtt:
              - APIDDLQ86883D54
              - QueueName
      EvaluationPeriods: 1
      MetricName: ApproximateNumberOfMessagesVisible
      Namespace: AWS/SQS
      Period: 300
      Statistic: Maximum
      Threshold: 0
    Metadata:
      aws:cdk:path: OptionAIngestionDemoPy/API-DDLQAlarm/Resource
  APIAAgeAlarmB5E5BBA7:
    Type: AWS::CloudWatch::Alarm
    Properties:
      ComparisonOperator: GreaterThanThreshold
      DatapointsToAlarm: 1
      Dimensions:
        - Name: QueueName
          Value:
            Fn::GetAtt:
              - APIAQueue131AD127
              - QueueName
      EvaluationPeriods: 1
      MetricName: ApproximateAgeOfOldestMessage
      Namespace: AWS/SQS
      Period: 300
      Statistic: Maximum
      Threshold: 300
    Metadata:
      aws:cdk:path: OptionAIngestionDemoPy/API-AAgeAlarm/Resource
  APIBAgeAlarmE90EBFE3:
    Type: AWS::CloudWatch::Alarm
    Properties:
      ComparisonOperator: GreaterThanThreshold
      DatapointsToAlarm: 1
      Dimensions:
        - Name: QueueName
          Value:
            Fn::GetAtt:
              - APIBQueue86514826
              - QueueName
      EvaluationPeriods: 1
      MetricName: ApproximateAgeOfOldestMessage
      Namespace: AWS/SQS
      Period: 300
      Statistic: Maximum
      Threshold: 300
    Metadata:
      aws:cdk:path: OptionAIngestionDemoPy/API-BAgeAlarm/Resource
  APICAgeAlarmAD61D1F2:
    Type: AWS::CloudWatch::Alarm
    Properties:
      ComparisonOperator: GreaterThanThreshold
      DatapointsToAlarm: 1
      Dimensions:
        - Name: QueueName
          Value:
            Fn::GetAtt:
              - APICQueue41397192
              - QueueName
      EvaluationPeriods: 1
      MetricName: ApproximateAgeOfOldestMessage
      Namespace: AWS/SQS
      Period: 300
      Statistic: Maximum
      Threshold: 300
    Metadata:
      aws:cdk:path: OptionAIngestionDemoPy/API-CAgeAlarm/Resource
  APIDAgeAlarm1BCE3A89:
    Type: AWS::CloudWatch::Alarm
    Properties:
      ComparisonOperator: GreaterThanThreshold
      DatapointsToAlarm: 1
      Dimensions:
        - Name: QueueName
          Value:
            Fn::GetAtt:
              - APIDQueue6C5AE567
              - QueueName
      EvaluationPeriods: 1
      MetricName: ApproximateAgeOfOldestMessage
      Namespace: AWS/SQS
      Period: 300
      Statistic: Maximum
      Threshold: 300
    Metadata:
      aws:cdk:path: OptionAIngestionDemoPy/API-DAgeAlarm/Resource
  WorkerErrorsAlarm1932B217:
    Type: AWS::CloudWatch::Alarm
    Properties:
      ComparisonOperator: GreaterThanOrEqualToThreshold
      DatapointsToAlarm: 1
      Dimensions:
        - Name: FunctionName
          Value:
            Ref: WorkerFn847949AF
      EvaluationPeriods: 1
      MetricName: Errors
      Namespace: AWS/Lambda
      Period: 300
      Statistic: Sum
      Threshold: 1
    Metadata:
      aws:cdk:path: OptionAIngestionDemoPy/WorkerErrorsAlarm/Resource
  CDKMetadata:
    Type: AWS::CDK::Metadata
    Properties:
      Analytics: v2:deflate64:H4sIAAAAAAAA/2VQy07DMBD8lt7d5VEhuLbhcSiIkh44Vttkk5o4dsjaRJHlf0d2IlqJ08zurHdnfAs3dw9wvcCBl0XZLJU8gt9bLBqBAx980zL4LY0iq/SWxiB4BX7jioZsbM1sgp1RshjP7bmeig0yBcHfDP7DkaM4lkgQCttjieCfnS6sNDpKl3xHfSuZY/X0Q9rujesLesOuk7qOA/+7QUhswedGpUMJz/YmFrMckJkswzqCUKZmeDV1TpZ0uk5xM4PP3bzIKQqiVo7AZ5V+RItH5CRlPQ6K+iDQnkgjZJX+NH3z0hvXiUIZVw5oixP4tcK+jS8SCUHkxMm7SC72Fus515+QVfoi7ruznUvfnxldymg0iN1oT0ZfreBmBfeLL5Zy2TttZUuQT/gLZpfBAusBAAA=
    Metadata:
      aws:cdk:path: OptionAIngestionDemoPy/CDKMetadata/Default
    Condition: CDKMetadataAvailable
Mappings:
  LatestNodeRuntimeMap:
    af-south-1:
      value: nodejs20.x
    ap-east-1:
      value: nodejs20.x
    ap-northeast-1:
      value: nodejs20.x
    ap-northeast-2:
      value: nodejs20.x
    ap-northeast-3:
      value: nodejs20.x
    ap-south-1:
      value: nodejs20.x
    ap-south-2:
      value: nodejs20.x
    ap-southeast-1:
      value: nodejs20.x
    ap-southeast-2:
      value: nodejs20.x
    ap-southeast-3:
      value: nodejs20.x
    ap-southeast-4:
      value: nodejs20.x
    ap-southeast-5:
      value: nodejs20.x
    ap-southeast-7:
      value: nodejs20.x
    ca-central-1:
      value: nodejs20.x
    ca-west-1:
      value: nodejs20.x
    cn-north-1:
      value: nodejs18.x
    cn-northwest-1:
      value: nodejs18.x
    eu-central-1:
      value: nodejs20.x
    eu-central-2:
      value: nodejs20.x
    eu-isoe-west-1:
      value: nodejs18.x
    eu-north-1:
      value: nodejs20.x
    eu-south-1:
      value: nodejs20.x
    eu-south-2:
      value: nodejs20.x
    eu-west-1:
      value: nodejs20.x
    eu-west-2:
      value: nodejs20.x
    eu-west-3:
      value: nodejs20.x
    il-central-1:
      value: nodejs20.x
    me-central-1:
      value: nodejs20.x
    me-south-1:
      value: nodejs20.x
    mx-central-1:
      value: nodejs20.x
    sa-east-1:
      value: nodejs20.x
    us-east-1:
      value: nodejs20.x
    us-east-2:
      value: nodejs20.x
    us-gov-east-1:
      value: nodejs18.x
    us-gov-west-1:
      value: nodejs18.x
    us-iso-east-1:
      value: nodejs18.x
    us-iso-west-1:
      value: nodejs18.x
    us-isob-east-1:
      value: nodejs18.x
    us-west-1:
      value: nodejs20.x
    us-west-2:
      value: nodejs20.x
Outputs:
  DataLakeBucketName:
    Value:
      Ref: DataLakeBucket0256EA8E
  AthenaResultsBucketName:
    Value:
      Ref: AthenaResultsBucket879938FA
  DataLakeKeyArn:
    Value:
      Fn::GetAtt:
        - DataLakeKey37130A3E
        - Arn
  GlueDatabaseName:
    Value: option_a_demo_db
  GlueCrawlerName:
    Value: option-a-raw-crawler
  WorkGroupName:
    Value: option_a_demo_wg
  PlannerFunctionName:
    Value:
      Ref: PlannerFn9855CFD1
  WorkerFunctionName:
    Value:
      Ref: WorkerFn847949AF
Conditions:
  CDKMetadataAvailable:
    Fn::Or:
      - Fn::Or:
          - Fn::Equals:
              - Ref: AWS::Region
              - af-south-1
          - Fn::Equals:
              - Ref: AWS::Region
              - ap-east-1
          - Fn::Equals:
              - Ref: AWS::Region
              - ap-northeast-1
          - Fn::Equals:
              - Ref: AWS::Region
              - ap-northeast-2
          - Fn::Equals:
              - Ref: AWS::Region
              - ap-northeast-3
          - Fn::Equals:
              - Ref: AWS::Region
              - ap-south-1
          - Fn::Equals:
              - Ref: AWS::Region
              - ap-south-2
          - Fn::Equals:
              - Ref: AWS::Region
              - ap-southeast-1
          - Fn::Equals:
              - Ref: AWS::Region
              - ap-southeast-2
          - Fn::Equals:
              - Ref: AWS::Region
              - ap-southeast-3
      - Fn::Or:
          - Fn::Equals:
              - Ref: AWS::Region
              - ap-southeast-4
          - Fn::Equals:
              - Ref: AWS::Region
              - ca-central-1
          - Fn::Equals:
              - Ref: AWS::Region
              - ca-west-1
          - Fn::Equals:
              - Ref: AWS::Region
              - cn-north-1
          - Fn::Equals:
              - Ref: AWS::Region
              - cn-northwest-1
          - Fn::Equals:
              - Ref: AWS::Region
              - eu-central-1
          - Fn::Equals:
              - Ref: AWS::Region
              - eu-central-2
          - Fn::Equals:
              - Ref: AWS::Region
              - eu-north-1
          - Fn::Equals:
              - Ref: AWS::Region
              - eu-south-1
          - Fn::Equals:
              - Ref: AWS::Region
              - eu-south-2
      - Fn::Or:
          - Fn::Equals:
              - Ref: AWS::Region
              - eu-west-1
          - Fn::Equals:
              - Ref: AWS::Region
              - eu-west-2
          - Fn::Equals:
              - Ref: AWS::Region
              - eu-west-3
          - Fn::Equals:
              - Ref: AWS::Region
              - il-central-1
          - Fn::Equals:
              - Ref: AWS::Region
              - me-central-1
          - Fn::Equals:
              - Ref: AWS::Region
              - me-south-1
          - Fn::Equals:
              - Ref: AWS::Region
              - sa-east-1
          - Fn::Equals:
              - Ref: AWS::Region
              - us-east-1
          - Fn::Equals:
              - Ref: AWS::Region
              - us-east-2
          - Fn::Equals:
              - Ref: AWS::Region
              - us-west-1
      - Fn::Equals:
          - Ref: AWS::Region
          - us-west-2
Parameters:
  BootstrapVersion:
    Type: AWS::SSM::Parameter::Value<String>
    Default: /cdk-bootstrap/hnb659fds/version
    Description: Version of the CDK Bootstrap resources in this environment, automatically retrieved from SSM Parameter Store. [cdk:skip]

